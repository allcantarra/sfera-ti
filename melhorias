# üöÄ GUIA COMPLETO - Como Aplicar as Melhorias no SFERA TI

## ‚úÖ O Que Foi Feito

Criei vers√µes atualizadas de TODOS os arquivos do seu sistema com as seguintes melhorias:

### 1. **Banco de Dados (init.sql)**
- ‚úÖ Campo `tipo_franquia` nas lojas (6 tipos)
- ‚úÖ Campo `propriedade` nas impressoras (Pr√≥pria/Alugada)
- ‚úÖ 10 novos campos na tabela de links de internet
- ‚úÖ Nova tabela `fornecedores` completa
- ‚úÖ Nova tabela `cftv_dispositivos` completa
- ‚úÖ View `vw_resumo_lojas` atualizada
- ‚úÖ √çndices de performance adicionados

### 2. **Backend (server.js)**
- ‚úÖ Rota GET /api/lojas com filtro de franquia
- ‚úÖ Rotas de impressoras atualizadas com campo propriedade
- ‚úÖ Rotas de links atualizadas com todos os campos novos
- ‚úÖ 5 novas rotas para Fornecedores (GET, GET/:id, POST, PUT, DELETE)
- ‚úÖ 5 novas rotas para CFTV (GET, GET/:id, POST, PUT, DELETE)
- ‚úÖ Dashboard atualizado com totais de fornecedores e CFTV

### 3. **Frontend (App.js)**
- ‚úÖ 2 novos itens no menu: Fornecedores e CFTV
- ‚úÖ Filtro dropdown de franquias na p√°gina de Lojas
- ‚úÖ Campo tipo_franquia no formul√°rio de lojas
- ‚úÖ Dashboard mostrando novos totais
- ‚úÖ Todas as p√°ginas integradas

### 4. **Components.js**
- ‚úÖ Ser√° atualizado no pr√≥ximo artefato
- ‚úÖ Novos componentes: Fornecedores e CFTV

---

## üìã Passos para Aplicar

### Passo 1: BACKUP

ANTES DE TUDO, fa√ßa backup:

```powershell
# Parar o sistema
docker-compose down

# Fazer backup do banco
docker exec triloga_db pg_dump -U triloga_admin triloga_empresarial > backup_antes_update.sql

# Copiar arquivos atuais
cp backend/server.js backend/server.js.backup
cp frontend/src/App.js frontend/src/App.js.backup
cp database/init.sql database/init.sql.backup
```

### Passo 2: Atualizar o Banco de Dados

**Op√ß√£o A: Reconstruir do Zero (RECOMENDADO)**

```powershell
# Parar e remover tudo
docker-compose down -v

# Substituir o arquivo init.sql pelo novo
# (Copie o conte√∫do do artefato "database/init.sql - ATUALIZADO")

# Subir novamente
docker-compose up --build
```

**Op√ß√£o B: Migra√ß√£o (Mant√©m dados)**

```sql
-- Execute no banco de dados existente:

-- 1. Adicionar campo tipo_franquia
ALTER TABLE lojas ADD COLUMN IF NOT EXISTS tipo_franquia VARCHAR(50);

-- 2. Adicionar campo propriedade
ALTER TABLE impressoras ADD COLUMN IF NOT EXISTS propriedade VARCHAR(20) DEFAULT 'propria';

-- 3. Adicionar novos campos nos links
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS cp VARCHAR(50);
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS titular VARCHAR(255);
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS cnpj_titular VARCHAR(18);
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS valor_anual DECIMAL(10,2);
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS data_vencimento VARCHAR(10);
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS linha_fixa VARCHAR(20);
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS link_acesso TEXT;
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS login_acesso VARCHAR(255);
ALTER TABLE links_internet ADD COLUMN IF NOT EXISTS senha_acesso VARCHAR(255);

-- 4. Criar tabela fornecedores
-- (Copie o CREATE TABLE do arquivo SQL atualizado)

-- 5. Criar tabela cftv_dispositivos
-- (Copie o CREATE TABLE do arquivo SQL atualizado)
```

### Passo 3: Atualizar o Backend

**Arquivo**: `backend/server.js`

1. **SUBSTITUIR o arquivo inteiro** pelos 3 artefatos:
   - Parte 1/2
   - Parte 2/2
   - Parte 3/3 (Final)

2. **OU** Adicionar manualmente as se√ß√µes:
   - Se√ß√£o de Impressoras (adicionar campo propriedade)
   - Se√ß√£o de Links (adicionar novos campos)
   - Se√ß√£o de Lojas (adicionar filtro de franquia)
   - NOVA se√ß√£o: Rotas de Fornecedores
   - NOVA se√ß√£o: Rotas de CFTV

### Passo 4: Atualizar o Frontend App.js

**Arquivo**: `frontend/src/App.js`

**SUBSTITUIR completamente** pelo artefato "frontend/src/App.js - ATUALIZADO"

Principais mudan√ßas:
- Imports: Adicionar `Fornecedores` e `CFTV`
- Sidebar: Adicionar 2 novos itens no menu
- Header: Adicionar t√≠tulos para as novas p√°ginas
- Dashboard: Adicionar novos cards
- Lojas: Adicionar filtro de franquia e campo no formul√°rio

### Passo 5: Atualizar Components.js

Vou criar isso agora no pr√≥ximo artefato...

### Passo 6: Reconstruir e Testar

```powershell
# Reconstruir tudo
docker-compose down
docker-compose up --build

# Aguardar uns 2 minutos

# Testar
# Abrir: http://localhost
# Login: admin@sfera.com.br / admin123
```

---

## üß™ Checklist de Testes

Ap√≥s aplicar as melhorias, testar:

### Dashboard
- [ ] Mostra total de Fornecedores
- [ ] Mostra total de CFTV
- [ ] Cards de lojas mostram tipo de franquia

### Lojas
- [ ] Filtro dropdown funciona
- [ ] Pode selecionar tipo de franquia ao criar
- [ ] Pode selecionar tipo de franquia ao editar
- [ ] Tabela mostra coluna "Franquia"
- [ ] Bot√µes Editar e Excluir funcionam

### Impressoras
- [ ] Formul√°rio tem campo "Propriedade"
- [ ] Pode selecionar Pr√≥pria ou Alugada
- [ ] Tabela mostra a propriedade
- [ ] Bot√µes Editar e Excluir funcionam

### Links de Internet
- [ ] Formul√°rio tem todos os campos novos:
  - [ ] CP
  - [ ] Titular
  - [ ] CNPJ Titular
  - [ ] Linha Fixa
  - [ ] Data Vencimento
  - [ ] Valor Anual
  - [ ] Link de Acesso
  - [ ] Login
  - [ ] Senha
- [ ] Bot√µes Editar e Excluir funcionam

### Fornecedores (NOVO)
- [ ] Menu "Fornecedores" aparece
- [ ] P√°gina carrega corretamente
- [ ] Pode criar fornecedor
- [ ] Pode editar fornecedor
- [ ] Pode excluir fornecedor
- [ ] Filtro por segmento funciona
- [ ] Todos os campos s√£o salvos

### CFTV (NOVO)
- [ ] Menu "CFTV" aparece
- [ ] P√°gina carrega corretamente
- [ ] Pode criar dispositivo
- [ ] Pode editar dispositivo
- [ ] Pode excluir dispositivo
- [ ] Filtro por loja funciona
- [ ] Campos de canais funcionam
- [ ] Todos os campos s√£o salvos

---

## üîß Troubleshooting

### Erro: "column does not exist"
```sql
-- Execute as queries de ALTER TABLE do Passo 2
```

### Erro: "relation fornecedores does not exist"
```sql
-- Execute o CREATE TABLE completo para fornecedores
```

### Erro: "Cannot find module Fornecedores"
```javascript
// Verifique se Components.js foi atualizado
// Verifique se o export est√° correto
```

### Frontend n√£o atualiza
```powershell
# Limpar cache do navegador
# Ou reconstruir frontend
docker-compose down
docker-compose up --build frontend
```

### Backend n√£o inicia
```powershell
# Ver logs
docker-compose logs backend

# Se erro de sintaxe, verifique se copiou todos os 3 arquivos
# Se erro de conex√£o, verifique se banco est√° rodando
docker-compose ps
```

---

## üìä Resultado Final

Ap√≥s aplicar TODAS as melhorias, voc√™ ter√°:

‚úÖ **Sistema com 6 tipos de franquias**
‚úÖ **Filtro para ver lojas por franquia**
‚úÖ **Impressoras com campo Pr√≥pria/Alugada**
‚úÖ **Links de internet com 10+ campos novos**
‚úÖ **M√≥dulo completo de Fornecedores**
‚úÖ **M√≥dulo completo de CFTV**
‚úÖ **CRUD completo (Criar, Editar, Excluir) em TUDO**
‚úÖ **Dashboard atualizado**
‚úÖ **Sistema pronto para substituir Excel 100%**

---

## üíæ Arquivos Criados

Voc√™ recebeu os seguintes artefatos:

1. **database/init.sql - ATUALIZADO**
2. **backend/server.js - ATUALIZADO (Parte 1/2)**
3. **backend/server.js - ATUALIZADO (Parte 2/2)**
4. **backend/server.js - ATUALIZADO (Parte 3/3 - Final)**
5. **frontend/src/App.js - ATUALIZADO**
6. **Este guia (COMO_APLICAR_MELHORIAS.md)**

Falta criar:
- **frontend/src/Components.js - ATUALIZADO** (vou criar agora)

---

## üéØ Pr√≥ximos Passos

1. Aplicar as mudan√ßas seguindo este guia
2. Testar todas as funcionalidades
3. Migrar dados do Excel
4. Treinar equipe
5. Descontinuar Excel! üéâ

---

**Boa sorte com o upgrade! üöÄ**

Se tiver qualquer d√∫vida durante a aplica√ß√£o, me avise!